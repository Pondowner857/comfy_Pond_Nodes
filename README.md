# 🐳 Pond Nodes for ComfyUI

这是一个为ComfyUI设计的多功能节点插件集合，提供了丰富的图像处理和遮罩操作功能。

## ✨ 功能特点

该插件集合包含多种实用节点，可以帮助你：

- 🔍 **YOLO对象检测与裁剪**：
  - YOLO检测裁剪：智能检测并裁剪图像中的对象，支持类别过滤和置信度设置
  - YOLO图像拼接：将检测到的对象拼接到其他图像上

- 🎭 **高级遮罩操作**：
  - 遮罩布尔运算：支持交集、并集、差集、异或等操作，带有9种对齐方式
  - 多遮罩运算：支持多个遮罩的连续布尔运算
  - 遮罩合并与合成：提供遮罩合并和多遮罩合并节点
  - 遮罩区域扩展：可在四个方向扩展遮罩区域，支持渐变过渡
  - 遮罩百分比羽化：基于百分比调整羽化半径，可保持锐利边缘
  - 遮罩尺寸对齐：自动对齐不同尺寸的遮罩
  - 遮罩移除：移除图像中的遮罩区域
  - 遮罩切换：在不同遮罩间灵活切换

- 👤 **人体部位处理**：
  - 人体部位选择器：轻松选择并处理人体特定部位
  - 肢体选择器：支持20多个人体部位的选择，如眼睛、嘴巴、手臂等

- 🖼️ **图像处理**：
  - RealESRGAN超分辨率：使用ONNX格式的RealESRGAN模型进行高质量图像放大
  - 图像反相：一键反转图像颜色
  - 去饱和度：基础和高级图像去色功能
  - 像素处理：像素化、像素校正、局部像素化和像素增强
  - 逼真噪点：添加自然外观的噪点，支持多种参数调整

- 📝 **文本处理**：
  - 文本清理器：清理和优化提示文本，支持标签过滤和句子过滤

- 📊 **元数据工具**：
  - 删除元数据：从图像中删除元数据
  - 加载图像(清除元数据)：加载图像的同时清除元数据
  - 查看元数据：检查图像的元数据信息
  - 批量删除元数据：批量处理多张图像的元数据

- 🧠 **内存管理**：
  - 内存管理器：优化节点处理过程中的内存使用，提高处理效率

## 📂 模块文件与功能对应

本插件包含以下Python模块文件，每个文件实现了特定的功能节点：

| 文件名 | 节点名称 | 功能描述 |
| ------ | ------- | ------- |
| **yoloCrop.py** | 🐳YOLO检测裁剪 | 使用YOLO模型检测图像中的对象并智能裁剪，支持多种检测类别和裁剪模式 |
| **yoloPaste.py** | 🐳YOLO图像拼接 | 将检测到的对象智能拼接到其他图像上，支持位置调整 |
| **MaskBoolean.py** | 🐳遮罩运算, 🐳多遮罩运算 | 遮罩对齐布尔运算和多遮罩连续布尔运算，支持多种布尔操作 |
| **MaskComposite.py** | 🐳遮罩合成 | 复杂的遮罩合成工具，用于创建高级合成效果 |
| **MaskMerge.py** | 🐳多遮罩合并, 🐳遮罩合并 | 提供简单和高级两种遮罩合并功能 |
| **MaskRegionExpand.py** | 🐳遮罩区域扩展 | 在四个方向扩展遮罩区域，支持渐变过渡和边缘平滑 |
| **MaskFeatherPercentage.py** | 🐳遮罩百分比羽化 | 基于图像尺寸百分比调整羽化半径，可保持锐利边缘 |
| **MaskSizeAlign.py** | 🐳遮罩尺寸对齐 | 将不同尺寸的遮罩调整为相同尺寸，支持多种对齐方式 |
| **MaskRemove.py** | 🐳遮罩移除 | 从图像中移除遮罩区域，支持多种填充方式 |
| **MaskSwitch.py** | 🐳遮罩切换 | 在多个遮罩之间进行条件切换 |
| **BodyPartSelector.py** | 🐳人体部位选择器 | 人体主要部位的选择器，用于与ControlNet等配合使用 |
| **LimbSelector.py** | 🐳肢体选择器 | 详细的人体肢体部位选择器，支持20多个人体部位 |
| **RealESRGANUpscaler.py** | 🐳RealESRGAN 超分辨率 | 使用ONNX格式的RealESRGAN模型进行高质量图像放大 |
| **InvertImage.py** | 🐳图像反相 | 一键反转图像颜色，带有开关控制 |
| **desaturate.py** | 🐳图像去色, 🐳图像去色(V2) | 基础和高级的图像去饱和度处理 |
| **square_pixel.py** | 🐳像素化, 🐳像素校正, 🐳局部像素化, 🐳像素增强 | 多种像素艺术风格处理工具 |
| **RealisticNoise.py** | 🐳噪点调节 | 添加自然外观的噪点，支持多种参数调整 |
| **TextCleaner.py** | 🐳文本清理器 | 清理和优化提示文本，支持标签过滤和句子过滤 |
| **MetadataUtils.py** | 🐳删除元数据, 🐳加载图像(清除元数据), 🐳查看元数据, 🐳批量删除元数据 | 图像元数据处理工具集 |
| **MemoryManager.py** | 🐳内存管理器 | 优化节点处理过程中的内存使用 |
| **__init__.py** | - | 插件初始化文件，整合所有节点到ComfyUI |

## 📋 依赖要求

- ComfyUI最新版本
- Python 3.8+
- torch >= 2.0.0
- Pillow >= 9.0.0
- numpy >= 1.22.0
- ultralytics >= 8.0.0 (用于YOLO功能)
- onnxruntime >= 1.14.0 (用于RealESRGAN超分辨率)

## 💾 安装方法

### 方法1：使用ComfyUI Manager (推荐)

1. 在ComfyUI中安装ComfyUI Manager
2. 在Custom Nodes选项卡中搜索"Pond Nodes"并安装

### 方法2：手动安装

1. 克隆或下载此仓库
2. 将文件夹放入ComfyUI的`custom_nodes`目录
3. 安装所需依赖：
   ```bash
   pip install -r requirements.txt
   ```

## 📌 模型设置

- 模型的下载链接:https://pan.baidu.com/s/1xx6KEsdyj9bvV5MlGZcvLQ?pwd=ukr2

### YOLO模型
- 将YOLO模型文件 (.pt) 放入 `ComfyUI/models/yolo/` 目录
- 推荐使用 YOLOv8 模型，如 yolov8n.pt 或 yolov8s.pt

### RealESRGAN模型
- 将RealESRGAN ONNX模型放入 `ComfyUI/models/` 目录
- 默认使用 real_esrgan_x4_fp16.onnx

## 🚀 使用说明

### YOLO节点

1. **YOLO检测裁剪**：
   - 输入图像并选择YOLO模型
   - 设置置信度阈值和类别过滤
   - 支持多种裁剪模式：全部对象、单个对象、按类别
   - 可调整裁剪区域的扩展范围

2. **YOLO图像拼接**：
   - 将检测到的对象智能拼接到其他图像上
   - 支持自动对齐和位置调整

### 遮罩操作节点

1. **遮罩对齐布尔运算**：
   - 提供两个遮罩并选择对齐方式（9种不同对齐模式）
   - 支持交集、并集、差集A-B、差集B-A、异或、非A、非B等布尔运算
   - 可添加X轴和Y轴偏移量和阈值设置

2. **多遮罩运算**：
   - 支持多个遮罩的连续布尔运算
   - 灵活配置每步运算方式

3. **遮罩合并**：
   - 合并多个遮罩，应用不同的混合模式
   - 调整透明度和优先级

4. **遮罩区域扩展**：
   - 可在左、上、右、下四个方向扩展遮罩区域
   - 支持扩展黑色或白色区域
   - 提供边缘平滑和渐变过渡选项

5. **遮罩百分比羽化**：
   - 基于图像尺寸百分比调整羽化半径
   - 可选择是否保持锐利边缘

### 图像处理节点

1. **RealESRGAN超分辨率**：
   - 使用ONNX格式的RealESRGAN模型进行图像放大
   - 支持混合参数调整，平滑过渡效果

2. **图像反相**：
   - 一键反转图像颜色
   - 带开关控制，方便在工作流中使用

3. **去饱和度**：
   - 基础去色功能和高级去色选项
   - 支持亮度保持和不同的去色算法

4. **像素处理**：
   - 像素化：将图像转换为像素艺术风格
   - 像素校正：修正像素比例问题
   - 局部像素化：只对图像的特定部分进行像素化
   - 像素增强：增强像素艺术风格图像的质量

5. **逼真噪点**：
   - 添加自然外观的噪点
   - 支持多种噪点类型、强度和随机种子设置

### 文本处理节点

1. **文本清理器**：
   - 删除标签/提示词或包含这些词的整个句子
   - 支持多种分隔符和中英文标点识别

### 元数据工具节点

1. **删除元数据**：
   - 从单张图像中删除元数据
   - 保留图像质量不变

2. **加载图像(清除元数据)**：
   - 在加载图像的同时清除元数据
   - 避免敏感信息的传递

3. **查看元数据**：
   - 检查图像中包含的元数据信息
   - 以可读形式显示

4. **批量删除元数据**：
   - 处理多张图像的元数据
   - 提高工作效率

### 内存管理节点

1. **内存管理器**：
   - 优化内存使用，提高大型工作流的稳定性
   - 在关键点清理不需要的缓存数据

## 📄 许可证

该项目采用[MIT许可证](LICENSE)。

## 📬 问题与反馈

如有问题或建议，请通过Issues页面联系我。 